package com.sap.cds.feature.attachments.service.malware;

import static org.mockito.Mockito.mock;

import java.util.Collections;

import org.junit.jupiter.api.BeforeAll;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;

import com.sap.cds.feature.attachments.generated.test.cds4j.unit.test.Attachment_;
import com.sap.cds.feature.attachments.handler.helper.RuntimeHelper;
import com.sap.cds.feature.attachments.service.AttachmentService;
import com.sap.cds.feature.attachments.service.malware.client.MalwareScanClient;
import com.sap.cds.services.persistence.PersistenceService;
import com.sap.cds.services.runtime.CdsRuntime;

class DefaultAttachmentMalwareScannerTest {

	private static CdsRuntime runtime;

	private DefaultAttachmentMalwareScanner cut;
	private PersistenceService persistenceService;
	private AttachmentService attachmentService;
	private MalwareScanClient malwareScanClient;

	@BeforeAll
	static void classSetup() {
		runtime = RuntimeHelper.runtime;
	}

	@BeforeEach
	void setup() {
		persistenceService = mock(PersistenceService.class);
		attachmentService = mock(AttachmentService.class);
		malwareScanClient = mock(MalwareScanClient.class);
		cut = new DefaultAttachmentMalwareScanner(persistenceService, attachmentService, malwareScanClient);
	}

	@Test
	void correctSelectForNonDraftEntity() {
		var entity = runtime.getCdsModel().findEntity(Attachment_.CDS_NAME);

		cut.scanAttachment(entity.orElseThrow(), Collections.emptyMap());
	}

}